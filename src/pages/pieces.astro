---
import BaseLayout from '../layouts/BaseLayout.astro';
import moments from '../data/moments.json';

// 日期格式化工具
const formatDate = (dateStr) => {
  const date = new Date(dateStr.replace(/-/g, '/'));
  const weekDays = ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'];
  return `${date.getFullYear()} 年 ${date.getMonth() + 1} 月 ${date.getDate()} 日 ${weekDays[date.getDay()]}`;
};

// 按时间从新到旧排序
const sortedMoments = [...moments].sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
---

<BaseLayout title="Pieces | 碎片" activeNav="pieces">
    <div class="filter-header">
        <div class="dropdown">
            <button class="dropbtn">所有记录</button>
            <div class="dropdown-content">
                <a href="#">2025年</a>
                <a href="#">2024年</a>
            </div>
        </div>
    </div>

    <div class="divider-diamond">
        <span>◆</span><span>◆</span><span>◆</span>
    </div>

    <div class="moment-list">
        {sortedMoments.map((item) => (
            <div class="moment-item">
                <div class="moment-avatar-box">
                    <img src="https://api.iconify.design/solar:user-circle-bold.svg?color=%23769FCD" class="moment-avatar-img" alt="Avatar">
                </div>
                <div class="moment-main">
                    <div class="moment-header">
                        <span class="moment-author">{item.author}</span>
                        <span class="moment-time">{formatDate(item.date)}</span>
                    </div>
                    <div class="moment-content">
                        <Fragment set:html={item.content} />
                        <div class="expand-btn">[查看]</div>
                    </div>
                    <div class="moment-footer">
                        <div class="moment-actions">
                            <div class="action-btn">
                                <svg class="icon-svg" viewBox="0 0 24 24"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>
                                <span>{item.comments}</span>
                            </div>
                            <div class="action-btn like">
                                <svg class="icon-svg" viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                                <span>{item.likes}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        ))}
    </div>
    
    <div style="height: 100px;"></div>
</BaseLayout>

<style>
    .filter-header { display: flex; align-items: center; gap: 15px; margin-bottom: 10px; position: relative; z-index: 20; }
    .dropdown { position: relative; display: inline-block; }
    .dropbtn { background: none; border: none; font-size: 1.6rem; font-weight: bold; color: var(--text-main); cursor: pointer; font-family: inherit; padding: 5px 0; display: flex; align-items: center; gap: 5px; }
    .dropbtn:hover { color: var(--col-4-dark); }
    .dropdown-content { display: none; position: absolute; top: 100%; left: 0; background-color: rgba(255, 255, 255, 0.95); min-width: 100px; max-height: 200px; overflow-y: auto; box-shadow: 0 5px 15px rgba(118, 159, 205, 0.2); border-radius: 8px; padding: 5px 0; z-index: 100; border: 1px solid var(--col-2-light); }
    .dropdown:hover .dropdown-content { display: block; }
    .dropdown-content a { color: var(--text-main); padding: 8px 15px; text-decoration: none; display: block; font-size: 0.95rem; }
    .dropdown-content a:hover { background-color: var(--col-2-light); color: var(--col-4-dark); }
    
    .divider-diamond { display: flex; justify-content: center; align-items: center; gap: 8px; color: #1a3c5e; font-size: 12px; margin: 20px 0 50px 0; opacity: 0.9; }

    .moment-list { display: flex; flex-direction: column; gap: 40px; }
    .moment-item { display: flex; gap: 20px; animation: fadeIn 0.5s ease; }
    .moment-avatar-box { flex-shrink: 0; }
    .moment-avatar-img { width: 50px; height: 50px; border-radius: 50%; border: 2px solid #fff; box-shadow: 0 2px 8px rgba(118, 159, 205, 0.2); background: #fff; padding: 2px; }
    .moment-main { flex: 1; display: flex; flex-direction: column; }
    .moment-header { display: flex; align-items: baseline; gap: 10px; margin-bottom: 8px; }
    .moment-author { font-size: 1.1rem; font-weight: bold; color: #333; }
    .moment-time { font-size: 0.85rem; color: var(--text-light); }
    .moment-content { background-color: #EEF2F5; border-radius: 12px; padding: 15px 20px; color: #444; font-size: 1rem; line-height: 1.7; text-align: left; word-break: break-word; margin-bottom: 12px; position: relative; white-space: pre-wrap; }
    .moment-content::before { content: ''; position: absolute; top: 15px; left: -8px; width: 0; height: 0; border-top: 8px solid transparent; border-bottom: 8px solid transparent; border-right: 10px solid #EEF2F5; }
    .expand-btn { float: right; margin-top: 5px; font-size: 0.85rem; color: var(--col-4-dark); cursor: pointer; font-weight: bold; }
    .moment-content::after { content: ""; display: table; clear: both; }
    .moment-actions { display: flex; gap: 25px; }
    .action-btn { display: flex; align-items: center; gap: 6px; color: var(--text-light); font-size: 0.9rem; cursor: pointer; }
    .action-btn:hover { color: var(--col-4-dark); }
    .icon-svg { width: 18px; height: 18px; fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
</style>
